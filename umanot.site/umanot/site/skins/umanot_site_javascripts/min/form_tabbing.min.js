var ploneFormTabbing={jqtConfig:{current:"selected"},max_tabs:10};!function($){ploneFormTabbing._buildTabs=function(e,i){for(var n=i.length>ploneFormTabbing.max_tabs,a,t=[],l="",r=0;r<i.length;r++){var o,s,d=i[r],b=d.id;switch(t[r]="#"+b,r){case 0:o='class="formTab firstFormTab"';break;case i.length-1:o='class="formTab lastFormTab"';break;default:o='class="formTab"'}n?(s="<option "+o+' id="'+b+'" value="'+b+'">',s+=$(d).text()+"</option>"):(s="<li "+o+'><a id="'+b+'" href="#'+b+'"><span>',s+=$(d).text()+"</span></a></li>"),l+=s,$(d).css({visibility:"hidden","font-size":"0",padding:"0",height:"0",width:"0","line-height":"0"})}return t=t.join(","),a=t.replace(/#fieldsetlegend-/g,"#fieldset-"),n?(l=$('<select class="formTabs">'+l+"</select>"),l.change(function(){var e=$(this).attr("value");$(this).parent().find("option#"+e).click()})):l=$('<ul class="formTabs">'+l+"</ul>"),l},ploneFormTabbing.initializeDL=function(){var e=$(ploneFormTabbing._buildTabs(this,$(this).children("dt"))),i=$(this).children("dd");$(this).before(e),i.addClass("formPanel"),e.tabs(i,ploneFormTabbing.jqtConfig)},ploneFormTabbing.initializeForm=function(){var e=$(this),i=e.children("fieldset");if(i.length){var n=ploneFormTabbing._buildTabs(this,i.children("legend"));$(this).prepend(n),i.addClass("formPanel"),$(this).find('input[name="fieldset"]').addClass("noUnloadProtection"),$(this).find(".formPanel:has(div.field span.required)").each(function(){var e=this.id.replace(/^fieldset-/,"#fieldsetlegend-");$(e).addClass("required")});var a=0,t=0,l=!1;$(this).find(".formPanel").each(function(){l||0==$(this).find("div.field.error").length||(a=t,l=!0),t+=1});var r="ul.formTabs";$(n).is("select.formTabs")&&(r="select.formTabs");var o=$.extend({},ploneFormTabbing.jqtConfig,{initialIndex:a});e.children(r).tabs(e.children("fieldset.formPanel"),o),e.submit(function(){var i;i=n.find("a.selected").length>=1?n.find("a.selected").attr("href").replace(/^#fieldsetlegend-/,"#fieldset-"):n.attr("value").replace(/^fieldsetlegend-/,"#fieldset-");var a=e.find('input[name="fieldset"]');i&&a&&a.val(i)}),$("#archetypes-schemata-links").addClass("hiddenStructure"),$("div.formControls input[name='form.button.previous'],div.formControls input[name='form.button.next']").remove()}},$.fn.ploneTabInit=function(e){return this.each(function(){var e=$(this);e.find("form.enableFormTabbing,div.enableFormTabbing").each(ploneFormTabbing.initializeForm),e.find("dl.enableFormTabbing").each(ploneFormTabbing.initializeDL);var i=e.find('.enableFormTabbing input[name="fieldset"]').val()||window.location.hash;i&&e.find('.enableFormTabbing .formTabs [id="'+i.replace("#","").replace('"',"").replace(/^fieldset-/,"fieldsetlegend-")+'"]').click()})},ploneFormTabbing.initialize=function(){$("body").ploneTabInit()}}(jQuery),jQuery(function(){ploneFormTabbing.initialize()});