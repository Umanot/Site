<html metal:use-macro="here/fullwidth_main_template/macros/master" i18n:domain="umanot.article">

  <head>
    <metal:js fill-slot="javascript_head_slot">
      <script type="text/javascript">
        function element_in_scroll(elem) {
          var top = $(window).scrollTop();
          var elem_top = $(elem).offset().top;
          return top > elem_top;
        }

        var ready = true;

        $(document).scroll(function (e) {
          var elem = $(".lastItem");

          if (ready && elem.length && element_in_scroll(elem)) {
            ready = false;
            var url = $('#forum-article-section').attr('data-url');
            var last_uid = $('#forum-article-section').attr('data-uid');

            $.ajax({
              url: url,
              data: {ajax_load: 1, last_uid: last_uid}
              // cache: false
            }).done(function (html) {
              $(".lastItem").removeClass('lastItem');

              var result = $('<div />').append(html).find('#post-listing').html();

              $("#post-listing").append(result);

              ready = true;

            });
          }
          ;
        });
      </script>
    </metal:js>
  </head>

  <body>

    <metal:headline fill-slot="headline_section_slot" tal:condition="not:view/last_uid">

      <div id="article-folder-headline">
        <div class="gridOverlay"></div>
        <div class="headlineContent">
          <h1 class="documentFirstHeading" tal:content="view/title">Trading for Life</h1>
        </div>
      </div>

    </metal:headline>

    <metal:phil fill-slot="main" tal:define="contents view/contents">
      <section id="forum-article-section" tal:attributes="data-uid contents/last_uid; data-url context/absolute_url">

        <div id="post-listing" class="forumStyle">
          <tal:loop tal:repeat="item contents/data">
            <article class="articleItem" tal:attributes="class python:'articleItem lastItem' if item['uid'] == contents['last_uid'] else 'articleItem'">

              <span tal:content="item/uid"></span>

              <div class="articleInner">
                <a class="articleImage" tal:condition="item/image" tal:attributes="href item/URL">
                  <tal:image content="structure item/image"></tal:image>
                </a>

                <a tal:attributes="href item/URL"><h3 class="articleTitle" tal:content="item/title">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Id, expedita autem nobis nisi fugiat excepturi</h3></a>

                <p tal:content="structure item/text"></p>

              </div>

            </article>
          </tal:loop>

        </div>
      </section>
    </metal:phil>
  </body>
</html>